<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>
<style th:replace="fragments.html :: style-nomalrize"></style>
<body>
<div class="container">
    <nav th:replace="fragments.html :: main-nav"></nav>
    <h3>일기장 보기</h3>
        <div th:object="${diaryForm}">
            <form th:action="@{'/diary-update/' + ${diaryForm.id}}" method="POST">
            <div>
                <span>등록일 : </span><span th:text="*{#temporals.format(createdDate, 'yyyy-MM-dd HH:mm')}"></span>
            </div>
            <div th:if="*{!createdDate.isEqual(modifiedDate)}">
                <span>수정일 : </span><span th:text="*{#temporals.format(modifiedDate, 'yyyy-MM-dd HH:mm')}"></span>
            </div>
            <div>
                <span>제목 : </span><span th:text="*{title}"></span>
            </div>
            <div>
                <span>내용 : </span><span th:text="*{content}"></span>
            </div>
            <div>
                <span>댓글 : </span><input type="text" th:id="reply" placeholder="댓글을 입력해주세요" th:field="*{reply}">
            </div>
                <div>
                    <img id="imgView" th:src="*{picture}" style="width: 100%;">
                </div>
                <input id="imgLink" type="hidden" th:field="*{picture}">
                <input id="upload" name="img" type="file" value="" accept="jpge,png,jpg"/>
                <div>
                    <input type="submit" th:value="수정">
                </div>
                <input type="hidden" th:field="*{num}">
                <input type="hidden" th:field="*{content}">
                <input type="hidden" th:field="*{title}">
            </form>
        </div>
    <footer th:replace="fragments.html :: footer"></footer>
</div>
</body>
<script type="text/javascript">

        const fileInput = document.getElementById("upload");
        const upload = (file) => {
            if (file && file.size < 5000000) {
                const formData = new FormData();

                formData.append("image", file);
                fetch("https://api.imgur.com/3/image", {
                    method: "POST",
                    headers: {
                        Authorization: "Client-ID c69f193f9abc941",
                        Accept: "application/json",
                    },
                    body: formData,
                })
                    .then((response) => response.json())
                    .then((response) => {
                        console.log(response);
                        console.log(response.data.link);
                        const imgLink = response.data.link;
                        $('#imgLink').val(imgLink);
                        $('#imgView').attr('src', imgLink)
                    });
            } else {
                console.error("파일 용량 초과");
            }
        };

        fileInput &&
        fileInput.addEventListener("change", () => {
            upload(fileInput.files[0]);
        });

</script>


</html>